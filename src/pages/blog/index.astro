---
import { getCollection } from 'astro:content';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

const allBlogPosts = await getCollection('blog');
allBlogPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

// Sammle alle Kategorien für die Sidebar
const categories = [
  ...new Set(allBlogPosts.map((post) => post.data.categories).filter(Boolean)),
].sort();
---

<StarlightPage
  frontmatter={{
    title: 'Akustische Archive & Transformation',
  }}
sidebar={[
  {
    label: 'Blog',
    items: [
      { label: 'Alle Beiträge', link: '/blog' },
      { label: '← Zurück zur Hauptseite', link: '/' },
    ],
  },
  ...(categories.length > 0 ? [{
    label: 'Kategorien',
    items: categories.map(cat => ({
      label: cat,
      link: `/blog/categories/${cat.toLowerCase().replace(/\s+/g, '-')}`,
    })),
  }] : []),
  {
    label: 'Neueste Beiträge',
    items: allBlogPosts
      .slice(0, 5)
      .map(p => ({
        label: p.data.title,
        link: `/blog/${p.slug}`,
        badge: p.data.categories ? { text: p.data.categories, variant: 'note' } : undefined,
      })),
  },
]}
>
  <div class="content-container">
    <p style="color: var(--sl-color-text-light);">
      Hier finden Sie meine Gedanken, technische Entdeckungen und akustische Architektur.
    </p>

    <ul style="list-style: none; padding: 0;">
      {
        allBlogPosts.map((post) => (
          <li style="margin-bottom: 25px; border-bottom: 1px solid var(--sl-color-hairline); padding-bottom: 15px;">
            <h2 style="font-size: 1.5em; margin-bottom: 5px;">
              <a
                href={`/blog/${post.slug}`}
                style="color: var(--sl-color-text); text-decoration: none;"
              >
                {post.data.title}
              </a>
            </h2>

            {post.data.categories && (
              <span style="display: inline-block; background: var(--sl-color-accent); color: var(--sl-color-black); padding: 2px 8px; border-radius: 4px; font-size: 0.75em; margin-bottom: 0.5rem;">
                {post.data.categories}
              </span>
            )}

            <time style="color: var(--sl-color-text-light); font-size: 0.9em; display: block; margin-top: 0.5rem;">
              {post.data.pubDate.toLocaleDateString('de-DE', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </time>

            {post.data.description && (
              <p style="color: var(--sl-color-text-light); margin-top: 0.5rem;">
                {post.data.description}
              </p>
            )}
          </li>
        ))
      }
    </ul>
  </div>

  <style>
    .content-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }
  </style>
</StarlightPage>
