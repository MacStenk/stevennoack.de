---
import { getCollection } from 'astro:content';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  
  // Sammle alle einzigartigen Kategorien
  const categories = [...new Set(allPosts.map(post => post.data.categories).filter(Boolean))];
  
  return categories.map(categories => ({
    params: { categories },
    props: {
      posts: allPosts.filter(post => post.data.categories === categories)
        .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
    },
  }));
}

const { categories } = Astro.params;
const { posts } = Astro.props;
---

<StarlightPage 
  frontmatter={{ 
    title: `Kategorie: ${categories}`,
  }}
  sidebar={[
    {
      label: 'Blog',
      items: [
        { label: '← Alle Beiträge', link: '/blog' },
        { label: 'Zurück zur Hauptseite', link: '/' },
      ],
    },
  ]}
>
  <div class="content-container">
    <p style="color: var(--sl-color-text-light); margin-bottom: 2rem;">
      {posts.length} Beitrag{posts.length !== 1 ? 'e' : ''} in dieser Kategorie
    </p>

    <ul style="list-style: none; padding: 0;">
      {posts.map((post) => (
        <li style="margin-bottom: 25px; border-bottom: 1px solid var(--sl-color-hairline); padding-bottom: 15px;">
          <h2 style="font-size: 1.5em; margin-bottom: 5px;">
            <a href={`/blog/${post.slug}`} style="color: var(--sl-color-text); text-decoration: none;">
              {post.data.title}
            </a>
          </h2>
          <time style="color: var(--sl-color-text-light); font-size: 0.9em;">
            {post.data.pubDate.toLocaleDateString('de-DE', { year: 'numeric', month: 'long', day: 'numeric' })}
          </time>
          {post.data.description && (
            <p style="color: var(--sl-color-text-light); margin-top: 0.5rem;">
              {post.data.description}
            </p>
          )}
        </li>
      ))}
    </ul>
  </div>

  <style>
    .content-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }
  </style>
</StarlightPage>